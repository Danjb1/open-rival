# Development Quickstart

This is a guide to getting started with Open-Rival development.

Please also read the [contributing guidelines](/docs/CONTRIBUTING.md).

## :world_map: Project Overview

Here is a summary of all the projects in the Open-Rival repo.

### [Open-Rival](/projects/Open-Rival)

> Rival Realms remake (_the game!_).

### [Open-Rival-test](/projects/Open-Rival-test)

> Unit tests for Open-Rival.

### [setup](/projects/setup)

> Installer for Open-Rival, that combines the various utilities listed below.

### [audio-extractor](/projects/audio-extractor)

> Standalone utility to extract the original game's audio.

### [campaign-extractor](/projects/campaign-extractor)

> Standalone utility to extract individual scenarios from campaign files.

### [image-extractor](/projects/image-extractor)

> Standalone utility to extract the original game's images.

### [interface-extractor](/projects/interface-extractor)

> Standalone utility to extract the original game's interface images.

### [texture-builder](/projects/texture-builder)

> Standalone utility to combine images into textures.

## :hammer: Build

These are the steps necessary in order to build and run Open-Rival.

### 1) Install & Run CMake

The project is configured using [CMake](https://cmake.org/).

Running CMake will produce the files necessary for compilation (for example, a Visual Studio solution).

It is recommended to use `build/x86` or `build/x64` as the output directory for CMake. Each architecture requires a separate CMake build.

![CMake GUI](/docs/images/cmake_gui.png)

An x86 solution can be generated by selecting "Win32" in CMake's "Configure" window.

![CMake GUI](/docs/images/cmake_gui_win32.png)

### 2) Install Dependencies

Open-Rival has various dependencies, described [here](/docs/dependencies.md).

Generally, dependencies should be placed in the `libs` folder.

The expected version numbers are listed in the [CMake build file](projects/Open-Rival/CMakeLists.txt).

For dynamically-linked libraries:
- Debug DLLs should be placed in the output directory alongside the generated executable (e.g. `build/x64/projects/Open-Rival/Debug`).
- Release DLLs should be placed in the `dist` folder.

### 3) Install Resources

At this point, it should be possible to build the solution using Visual Studio. However, the game cannot run without the required resources. Most of these are extracted from the original game by the "setup" project.

> Some resources are custom-made for, or bundled with, Open-Rival. These are included in the `dist/res` directory. When compiling the project, CMake will automatically copy the contents of this directory to the build folder for use during development.

To extract the required resources, build and run the [setup project](/projects/setup) (instructions in the [readme](/projects/setup/README.md)). This should create the folders `sound`, `textures` and `video` within the `setup/res` directory.

Copy these folders to a `res` folder inside the output directory (e.g. `build/x64/projects/Open-Rival/res`).

### 4) That's it! :tada:

Once the dependencies and resources are in place, you should be able to run the "Open-Rival" project!

## :stethoscope: Troubleshooting

### LNK1104	cannot open file 'XXXXX.lib'

This signifies that a library cannot be found by the linker.

Check that the library has been built and that the required `.lib` file is present in one of the linker's "Additional Library Directories".

### LNK4098: defaultlib 'LIBCMT' conflicts with use of other libs; use /NODEFAULTLIB:library

This signifies that a library is including a different C Runtime (CRT) from Open-Rival. Check the build settings of all libraries (C/C++ > Code Generation > Runtime Library).

Open-Rival uses "Multi-threaded Debug DLL (/MDd)" or "Multi-threaded DLL (/MD)", as this is the version [required by SDL](https://wiki.libsdl.org/SDL2/FAQWindows#when_using_visual_c_i_get_link_errors_relating_to_msvcrt.lib_or_libc). All libraries should be built with this same version.

### The code execution cannot proceed because XXXXX.dll was not found

This signifies a missing DLL file.

Check that the folder containing `Open-Rival.exe` also contains the [required DLLs](/docs/dependencies.md#dll-files), and that these are the correct DLLs for the current architecture (x86 or x64).

### The application was unable to start correctly 0xc00007b

This signifies a missing or incorrect DLL file.

Check that the folder containing `Open-Rival.exe` also contains the [required DLLs](/docs/dependencies.md#dll-files), and that these are the correct DLLs for the current architecture (x86 or x64).

## :mag: Static Code Analysis

[Cppcheck](http://cppcheck.sourceforge.net/) should be run periodically.

> These scripts can also be found in the [tools](/tools) folder.

### Quick

```
cppcheck --project=Open-Rival.vcxproj "--project-configuration=Release|Win32"
```

### Full

```
cppcheck --project=Open-Rival.vcxproj
```

## :boom: Release

Instructions on building and packaging a version for release can be found [here](/docs/release_checklist.md).
